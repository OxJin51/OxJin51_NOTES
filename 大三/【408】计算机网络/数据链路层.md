# 数据链路层知识点讲解及习题解答

## 一、数据链路层知识点讲解

### 1. 数据链路层的三个基本问题

数据链路层的主要任务是将网络层交下来的数据封装成帧进行传输，并解决传输过程中的问题。三个基本问题是：**封装成帧**、**透明传输**和**差错检测**。这些问题的解决确保了数据可靠、无差错地通过数据链路层。

- **封装成帧**：

  数据链路层将网络层传递的数据添加首部和尾部，形成帧。首部和尾部用于帧定界（确定帧的界限），并包含控制信息。例如，课件中提到：

  > 封装成帧(framing):在一段数据的前后分别添加首部和尾部,构成一个帧。首部和尾部的一个重要作用就是进行帧定界(即确定帧的界限)。

  

  最大传送单元MTU规定了帧数据部分的上限。如果数据部分太短，可能需要填充字段。

- **透明传输**：

  指数据链路层能够传输任意比特组合的数据，而不会因为数据中出现的特殊字符（如SOH或EOT）被误解释为帧边界。课件中通过字节填充法解决：

  > 如果数据中的某个字节的二进制代码恰好和SOH或EOT一样，数据链路层就会错误地“找到帧的边界”。透明传输通过“字节填充”实现：在特殊字符前插入转义字符。

  

  例如，PPP协议使用字节填充（如0x7D转义）确保数据原样传输。

- **差错检测**：

  数据在传输中可能产生比特差错（如1→0）。数据链路层使用检错技术（如循环冗余检验CRC）来检测错误。课件中强调：

  > CRC是一种常用方法，通过在数据后添加冗余码（帧检验序列FCS）来实现。接收端通过计算校验和判断帧是否出错。

  

  但CRC只能做到“无差错接受”，并非可靠传输（可靠传输还需确认和重传机制）。

**为什么三个问题都必须解决？**

- **封装成帧**是基础，确保数据能被正确识别和分段。
- **透明传输**保证数据的完整性，避免因特殊字符导致帧定界错误。
- **差错检测**提高可靠性，避免错误数据被向上传递。 三者缺一不可，共同保障数据链路层的基本功能。课件中指出：“在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输。”因此，三个问题相辅相成。

### 2. 点对点协议PPP

PPP协议用于点对点链路，如用户到ISP的连接。它具有简单、透明、支持多种网络层协议等特点。

- **PPP帧格式**：

  包括首部（标志字段、地址字段、控制字段、协议字段）和尾部（FCS）。协议字段指示信息类型（如0x0021表示IP数据报）。

- **透明传输处理**： PPP使用字节填充（异步传输）或零比特填充（同步传输）。例如，字节填充中，0x7E转义为0x7D5E，0x7D转义为0x7D5D。

### 3. CSMA/CD协议

用于广播信道（如以太网），解决多站点访问冲突问题。

- **工作原理**：

  载波监听（发送前和发送中检测信道）、多点接入（总线型网络）、碰撞检测（检测信号电压变化）。检测到碰撞后，立即停止发送并执行退避算法。

- **关键概念**： **争用期**：端到端往返时延2τ，用于碰撞检测。对于10Mbit/s以太网，争用期为51.2μs，最短帧长为64字节（确保在争用期内能检测到碰撞）。 **退避算法**：截断二进制指数退避，重传时延 = r × 基本退避时间（基本退避时间为2τ）。 **最短帧长**：确保帧发送时间大于往返时延，避免发送完毕后才检测到碰撞。

## 二、习题解答

### 3-04 数据链路层的三个基本问题为什么都必须加以解决？

基于知识点讲解：

- **封装成帧**：如果不解决，数据无法被正确划分帧边界，导致接收方无法解析数据。课件中强调帧定界的重要性。
- **透明传输**：如果不解决，数据中的控制字符（如EOT）可能被误解释为帧结束，造成数据截断或错误。课件中通过例子说明透明传输的必要性。
- **差错检测**：如果不解决，比特差错可能导致数据错误，但网络层无法察觉。CRC检测虽不能保证可靠传输，但能丢弃无效帧，提高效率。 三者共同确保数据链路层提供基本的数据传输服务，缺一不可。

### 3-08 CRC计算：数据101110，生成多项式P(X)=X^3+1，求余数

课件中CRC计算步骤：

1. 生成多项式P(X)=X^3+1，对应二进制除数P=1001（因为X^3+1表示1×X^3 + 0×X^2 + 0×X^1 + 1×X^0，即1001）。

2. 数据M=101110，阶数k=6。添加n个0：n为除数位数减1，P是4位，所以n=3。因此，M后面加3个0，得到101110000。

3. 用101110000除以1001（模2除法）：

   - 模2除法是异或操作。

   - 计算过程：

     ```
     
     
       正确计算：
         生成多项式P=1001，n=3。
         数据M=101110，对应的多项式是X^5 + X^3 + X^2 + X^1（从左边开始，1=X^5, 0=X^4, 1=X^3, 1=X^2, 1=X^1, 0=X^0）。
         乘以X^3：101110000。
         除以1001（模2）：
           101110000
           1001      （异或，从左边开始）
           ----
           001010000 → 取1010000（去掉前导0）
           1010000
           1001     （异或，对齐前4位）
           ----
           0011000 → 11000
           11000
           1001    （异或，前4位1100大于1001）
           ----
           01010 → 1010
           1010
           1001   （异或）
           ----
           0011 → 余数011（3位）
         所以余数是011。
       验证：商为101011（通过异或计算得），余数011。
       因此，添加的余数是011。
     ```
   
4. **答案**：余数为**011**（二进制），即3位冗余码。

### 3-09 PPP帧数据部分：7D 5E FE 27 7D 5D 7D 5D 65 7D 5E，求真正数据

课件中PPP字节填充规则：

- 转义字符为0x7D，后跟的字符与0x20异或。
- 具体规则：0x7D5E表示原始0x7E，0x7D5D表示原始0x7D。 给定数据：7D 5E FE 27 7D 5D 7D 5D 65 7D 5E
- 扫描数据，遇到0x7D时，将其与后一个字节异或0x20： 7D 5E → 5E XOR 20 = 7E（所以原始是7E） 7D 5D → 5D XOR 20 = 7D（原始是7D） 注意：连续出现的7D 5D需要处理。
-  逐步解码：
-  7D 5E → 7E
-  FE → FE（直接保留）
-  27 → 27 
- 7D 5D → 7D 
- 7D 5D → 7D（另一个） 
- 65 → 65
-  7D 5E → 7E 
- 所以真正数据：7E FE 27 7D 7D 65 7E（十六进制）。 **答案**：真正数据是 **7E FE 27 7D 7D 65 7E**（十六进制）。

### 3-20 CSMA/CD最短帧长计算：网络长1km，数据率1Gbit/s，传播速率200,000km/s

CSMA/CD最短帧长公式：

- 最短帧长 = 2 × 传播时延 × 数据率
- 传播时延 = 距离 / 传播速率 计算：
- 传播时延τ = 1 km / 200,000 km/s = 5 × 10^{-6} s = 5 μs
- 往返时延2τ = 2 × 5 μs = 10 μs
- 数据率 = 1 Gbit/s = 10^9 bit/s
- 最短帧长 = 2τ × 数据率 = 10 × 10^{-6} s × 10^9 bit/s = 10,000 bit 转换为字节：10,000 bit / 8 = 1250字节。 但课件中强调，最短帧长通常以比特为单位，且需满足争用期内能发送完帧。 **答案**：最短帧长为 **10,000 bit**（或1250字节）。

### 3-22 CSMA/CD退避等待时间：r=100，10Mbit/s和100Mbit/s以太网

课件中退避算法：

- 基本退避时间 = 2τ（争用期）
- 对于10Mbit/s以太网，争用期2τ = 51.2 μs
- 重传时延 = r × 基本退避时间
- r=100，但r的取值范围由k决定（k=Min[重传次数,10]）。假设这是第一次重传（k=1），则r应从{0,1}中随机选择，但r=100超出范围？习题中给定r=100，可能假设k较大，使得r范围包含100。
- 根据算法，k=10时，r从0到2^10-1=1023中选择，所以r=100有效。

计算：

- **对于10Mbit/s以太网**： 基本退避时间 = 51.2 μs 等待时间 = r × 51.2 μs = 100 × 51.2 μs = 5120 μs = 5.12 ms
- **对于100Mbit/s以太网**： 争用期2τ不变（因为传播速率相同，但数据率提高，争用期缩短？课件中指出，100Mbit/s以太网将帧间间隔减小为0.96μs，但争用期计算基于传播时延）。 实际上，争用期2τ由物理长度决定，与数据率无关。但最短帧长变化：100Mbit/s以太网的基本退避时间仍是51.2 μs（因为标准规定争用期不变）。 因此，基本退避时间仍为51.2 μs。 等待时间 = 100 × 51.2 μs = 5120 μs = 5.12 ms（相同）。

但注意：100Mbit/s以太网在全双工方式下不使用CSMA/CD，但习题假设半双工。

**答案**：对于10Mbit/s和100Mbit/s以太网，等待时间均为 **5.12 ms**。
