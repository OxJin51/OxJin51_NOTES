# 单片机期末重点

09_19_01.c

```c
#include<reg52.h>
#include<intrins.h>
unsigned int a;
void delay(unsigned int z,unsigned int w)
{
	unsigned int x,y;
	for(x=0;x<z;x++)
		for(y=0;y<w;y++);
}
void main()
{
	a=0x80;
	while(1)
	{
		P2=a;
		delay(1000,40/4);
		a=_cror_(a,1);
	}
}
```



```c
09_19重点\09_19_02.c
#include<reg52.h>
/*#include<intrins.h>*/
unsigned int a,i;
void delay(unsigned int z,unsigned int w)
{
	unsigned int x,y;
	for(x=0;x<z;x++)
		for(y=0;y<w;y++);
}
void main()
{
	
	while(1)
	{
		a=0x80;
		for(i=0;i<8;i++){
		P2=a;
		delay(1000,40/4);
		a=a>>1;	}
	}
}
```



```c

09_19重点\09_19_03.c
#include<reg52.h>
/*#include<intrins.h>*/
unsigned int i;
unsigned int code zyzmd[]={0x01,0x03,0x07,0x0f,0x1f,0x3f,0x7f,0xff};
void delay(unsigned int z,unsigned int w)
{
	unsigned int x,y;
	for(x=0;x<z;x++)
		for(y=0;y<w;y++);
}
void main()
{
	
	while(1)
	{
		for(i=0;i<8;i++)
		{
			P2=zyzmd[i];
			delay(1000,40/4);
		}
	}
}
```

模块化编程

以 **`delay(1000,40)`≈ 0.5秒**为基准来控制时间。

*注：有时也采用 `delay(1000,42)`≈ 0.5秒 为基准，因为42更方便作为除数。*

- `delay(1000, 40 * 2);`≈ 1 秒
- `delay(1000, 40);`≈ 0.5 秒
- `delay(1000, 40/2);`≈ 0.25 秒
- `delay(1000, 40/4);`≈ 0.125 秒

```c
// delay.c
void delay (unsigned int z,unsigned int w)
{
	unsigned int i,j;
	for(i=0;i<z;i++)
	for(j=0;j<w;j++);
}

```

```c
// delay.h
#ifndef __delay_h__
#define __delay_h__
void delay (unsigned int z,unsigned int w);
#endif
```

```c
// lcd.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
#define uchar unsigned char
sbit lcdrw = P2^5;
sbit lcdrs = P2^6;
sbit lcden = P2^7;
void write_com(uchar com){
lcdrs = 0;
P0 = com;
delay(1000/100,40); lcden = 1;
delay(1000/100,40); lcden = 0;
}
void write_dat(uchar dat){
lcdrs = 1;
P0 = dat;
delay(1000/100,40); lcden = 1;
delay(1000/100,40); lcden = 0;
}
void lcd_ins()
{
  lcdrw=0; lcden=0;
  write_com(0x0f); write_com(0x38);
  write_com(0x01); write_com(0x0c);
  write_com(0x06); write_com(0x80);
}

```

```c
// lcd.h
#ifndef __lcd_h__
#define __lcd_h__
#define uchar unsigned char
void write_com(uchar com);
void write_dat(uchar dat);
void lcd_ins();
#endif
```



```c
09_28重点\09_28_01.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x00};
uint i;
void main()
{
	while(1)
	{
		P3=0xf8;
		for(i=0;i<10;i++)
		{
			P1=duanma[i];
			P2=~duanma[i+1];
			delay(1000,40*4);
		}
		
	}
}
```



```c
\09_28重点\09_28_02.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07};
uint code weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};
uint i,j;
void main()
{
	while(1)
	{
		for(j=0;j<8;j++)
		{
			P2=weixuan[j];
			for(i=0;i<8;i++)
			{
				P1=duanma[i];
				delay(1000,40/4);
			}
		}
	}
}
```



```c
09_28重点\09_28_03.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07};
uint code weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};
uint i;
void main()
{
	while(1)
	{
		for(i=0;i<8;i++)
		{
			P2=weixuan[i];
			P1=duanma[i];
			delay(1000/100,40/10);
			P1=0x00;
		}
	}
}
```



```c
09_28重点\09_28_04.c
#include <reg52.h>
#include "delay.h"
#define uint unsigned int
uint code duanma[]={0x5b,0x3f,0x5b,0x66,
0x77,0x7c,0x39,0x5e,0x3f,0x3f,0x3f,0x3f,
0x3f,0x3f,0x3f,0x3f,0x06,0x06,0x06,0x06,
0x06,0x06,0x06,0x06,0x4f,0x4f,0x4f,0x4f,
0x4f,0x4f,0x4f,0x4f};  
uint code weixuan[]={0x00,0x01,0x02,0x03,
0x04,0x05,0x06,0x07};
uint i,j,k;

void main()
{
    while(1)
    { 
        for(j=0;j<4;j++)
        {
            for(k=0;k<1000;k++)
            {
                for(i=(0);i<(8);i++)
                {
                    P2=weixuan[i];P0=duanma[i+8*j];
                    delay(1000/1000,40);P0=0x00;}}
                }
            }
}
```



```c
09_30重点第一个\09_30_01.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x5b,0x3f,0x5b,0x6d,0x3f,0x6f,0x4f,0x3f};
uint code weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};
uint i;
void main()
{
	while(1)
	{
		for(i=0;i<8;i++)
		{
			P2=weixuan[i];
			P0=duanma[i];
			delay(1000/100,40/10);
			P0=0x00;
			
		}
	}
}
```



```c
10_10重点第三个\10_10_03.c
#include <reg52.h>
#include "delay.h"
#define uint unsigned int
sbit fmq=P1^0;
uint i;
void main()
{
	while(1)
	{
		for(i=0;i<1200;i++)
		{
			fmq=~fmq;
			delay(1000/1000,42/2);
		
		}
		fmq=1;
		delay(1000,42);
			for(i=0;i<1200;i++)
		{
			fmq=~fmq;
			delay(1000/1000,42/2);
		
		}
		fmq=1;
		delay(1000,42);
			for(i=0;i<1200/3;i++)
		{
			fmq=~fmq;
			delay(1000/1000,42/2);
		
		}
		fmq=1;
		delay(1000,42);
	}
}
```



```C
10_14重点235\10_14_02.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
sbit k0=P1^0;sbit k1=P1^1;
sbit k2=P1^2;sbit k3=P1^3;
sbit k4=P1^4;sbit k5=P1^5;
sbit k6=P1^6;sbit k7=P1^7;
void main()
{
	P0=0x00;
	while(1)
	{

		if(P1!=0xff) 

		delay(1000/50,40);

		if(P1!=0xff)
		{
			if(k0==0) 
				P2=0x00;P0=0x3f;while(!k0);
			if(k1==0)
				P2=0x01;P0=0x06;while(!k1);
			if(k2==0)
				P2=0x02;P0=0x5b;while(!k2);
			if(k3==0) 
				P2=0x03;P0=0x4f;while(!k3);
			if(k4==0)
				P2=0x04;P0=0x66;while(!k4);
			if(k5==0)
				P2=0x05;P0=0x6d;while(!k5);
			if(k6==0)
				P2=0x06;P0=0x7d;while(!k6);
			if(k7==0)
				P2=0x07;P0=0x07;while(!k7);
		}
		
		P0=0x00;
	}
}
```



```c
10_14重点235\10_14_03.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
uint a;
sbit k0=P1^0;
sbit k7=P1^7;
void main()
{
    a=0;
    while(1)
    {
        P2=0x06;
        P0=duanma[a/10]; delay(1000/1000,40); P0=0x00;
        P2=0x07;
        P0=duanma[a%10]; delay(1000/1000,40); P0=0x00;
        
        if(k0==0) delay(1000/50,40);
        if(k0==0) a++; while(!k0);
        
        if(k7==0) delay(1000/50,40);
        if(k7==0) a--;while(!k7);

        if(a==21) a=0;
        if(a==-1) a=20;
    }
}
```



```c
10_14重点235\10_14_05.c
#include<reg52.h>
#include"delay.h"
#include"lcd.h"
#define uint unsigned int
#define uchar unsigned char
sbit lcdwr=P2^5;
sbit lcdrs=P2^6;
sbit lcden=P2^7;
uchar code s0[]="HUAINAN  SHIYUAN";
uchar code s1[]="1111111111ABCDEF";
uint i;
void main()
{
	lcd_ins();

	write_com(0x80+0x00);
	for(i=0;i<16;i++)
	{
		write_dat(s0[i]);
		delay(1000,40);
	}

	write_com(0x80+0x40);
	for(i=0;i<16;i++)
	{
		write_dat(s1[i]);
		delay(1000,40);
	}
	
	while(1);
}
```



```c
10_28重点第一个\10_28_01.c
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
 */
#include<reg52.h>
#include"delay.h"
#include"lcds1.h"
#define uint unsigned int
#define uchar unsigned char
uchar code s0[]="HUAINAN  SHIYUAN";
uchar code s1[]="0123456789ABCDEF";
uint i,j;
/*sbit lcdrw=P2^5;
sbit lcdrs=P2^6;
sbit lcden=P2^7;*/
void main()
{
	lcd_ins();
	while(1)
	{
		write_com(0x80+0x10);
		for(i=0;i<16;i++)
		{
			write_dat(s0[i]);
			delay(1000/100,40);
		}

		write_com(0x80+0x50);
		for(j=0;j<16;j++)
		{
			write_dat(s1[j]);
			delay(1000/100,40);
		}

		for(j=0;j<16;j++)
		{
			write_com(0x18);
			delay(1000,40);
		}

		delay(1000*6,40);
		
		write_com(0x01);
		
		delay(1000*6,40);
	}	
}
```



```c
11_04重点第一第二个\11_04_01.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07};
uint code weixuan[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};
sbit fmq=P1^0;
uint i,j;
void main()
{
    IT0=0;EX0=1;EA=1;
    IT1=0;EX1=1;PX1=1;
    while(1)
    {
        for(i=0;i<8;i++)
        {
            P2=weixuan[i];
            P0=duanma[i];
            delay(1000,40);
            P0=0x00;
        }
    }
}
void ex0_int() interrupt 0
{
    EX0=0;fmq=~fmq;delay(1000/1000,40);
    EX0=1; 
}
void ex1_int() interrupt 2
{
    EX1=0;

    for(j=0;j<600;j++)
    {
        fmq=~fmq;
        delay(1000/500,42/3);
    }
    
    fmq=0;
    delay(1000,40);

    EX1=1;
}
```



```c
11_04重点第一第二个\11_04_02.c
#include<reg52.h>
#include"delay.h"
sbit fmq=P1^0; sbit k1=P3^2;
sbit k8=P3^3;
void main()
{
	EA=1;IT0=0;EX0=1;
	IT1=0;EX1=1;
	while(1)
	{
		fmq=~fmq;
		delay(1000/500,42/3);
	}
}
void ex0_int() interrupt 0
{
	P0 = ~0x3f; 
	fmq=0;
	while(!k1);
	P0=~0x00;
}
void ex1_int() interrupt 2
{
	P0 = ~0x06; 
	fmq=0;
	while(!k8);
	P0=~0x00;
}
```



```c
11_11重点第一个\11_11_01.c
#include<reg52.h>
#include"delay.h"
#define uint unsigned int
uint code duanma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
uint sum00,sum01,sum1,sum2;
// sum00是T0的50毫秒个数
// sum01是T1的50毫秒个数
// sum1是秒数
// sum2是分钟数
void main()
{
    TMOD=0x11;TH0=(65536-50000)/256;
    TL0=(65536-50000)%256;
    EA=1;ET0=1;TR0=1;
    TH1=(65536-50000)/256;
    TL1=(65536-50000)%256;
    ET1=1;TR1=1;
    while(1)
    {
        P2=0x02;
        P0=duanma[sum2/10]; delay(1000/1000,40);P0=0x00;

        P2=0x03;
        P0=duanma[sum2%10];delay(1000/1000,40);P0=0x00;

        P2=0x04;
        P0=0x40; delay(1000/1000,40);P0=0x00;

        P2=0x05;
        P0=duanma[sum1/10];delay(1000/1000,40);P0=0x00;

        P2=0x06;
        P0=duanma[sum1%10];delay(1000/1000,40);P0=0x00;
        
        if(sum2==60) sum2=0;
        if(sum1==60) sum1=0;
    }
}
void et0_int() interrupt 1
{
    ET0=0;

    TH0=(65536-50000)/256;
    TL0=(65536-50000)%256;
    sum00++;

    if(sum00==20)
    {
        sum1++;
        sum00=0;
    }

    ET0=1;
}
void et1_int() interrupt 3
{
    ET1=0;
    
    TH1=(65536-50000)/256;
    TL1=(65536-50000)%256;
    sum01++;
    if(sum01==1200)
    {
        sum2++;
        sum01=0;
    }

    ET1=1;
}
```



```c
11_14重点第一个\11_14_01.c
#include <reg52.h>
#include "delay.h"
#define uint unsigned int
uint code duanma[] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f};
uint sum0, sum1; // sum0是0.01秒的个数，sum1是秒数
sbit k0 = P3 ^ 2;
sbit k7 = P3 ^ 3;
void main()
{
    TMOD = 0x10;
    TH1 = (65536 - 10000) / 256;
    TL1 = (65536 - 10000) % 256;
    EA = 1;
    ET1 = 1;
    TR1 = 1;
    IT0 = 0;
    EX0 = 1;
    IT1 = 0;
    EX1 = 1;
    while (1)
    {
        P1 = 0x02;
        P2 = duanma[sum1 / 10];
        delay(1000 / 1000, 40);
        P2 = 0x00;
        P1 = 0x03;
        P2 = duanma[sum1 % 10] | 0x80;
        delay(1000 / 1000, 40);
        P2 = 0x00;
        P1 = 0x04;
        P2 = duanma[sum0 / 10];
        delay(1000 / 1000, 40);
        P2 = 0x00;
        P1 = 0x05;
        P2 = duanma[sum0 % 10];
        delay(1000 / 1000, 40);
        P2 = 0x00;

        if (sum1 == 100)
            sum1 = 0;
        if (sum0 == 100)
            sum0 = 0;
    }
}
void t1_int() interrupt 3
{
    ET1 = 0;

    TH1 = (65536 - 10000) / 256;
    TL1 = (65536 - 10000) % 256;
    sum0++;
    if (sum0 == 100)
    {
        sum1++;
        sum0 = 0;
    }

    ET1 = 1;
}
void ex0_int() interrupt 0
{
    EX0 = 0;

    TR1 = ~TR1;
    delay(1000 / 2, 40);
    while (!k0);

    EX0 = 1;
}
void ex1_int() interrupt 2
{
    EX1 = 0;

    sum1 = 0;
    sum0 = 0;
    TR1 = 0;
    delay(1000 / 2, 40);
    while (!k7);

    EX1 = 1;
}

```



我已经把上本学期单片机课的所有需要掌握的代码上传给你 了（“单片机期末重点.md”）。

补充信息：单片机型号AT89C51，采用C51语言编写代码。

对于每个代码，给出下面几个内容。我有提供给你几个例子。

解释实现了什么效果（例1：主程序：蜂鸣器发出连续声音。外部中断0：大数码管显示0，停止发出声音。外部中断1：大数码管显示1，停止发出声音。例2：实现蜂鸣器发出500Hz、1000Hz、断续的声音。例3：利用数组法实现走马灯）

解释实现的思路

给出硬件连接（如：P0口接数码管/P1口接独立按键/P1口低三位（P1.0,P1.1,P1.2）连接到 3-8 译码器的输入端（A、B、C)/蜂鸣器接P1.0口。）

补充必要的代码注释

优化代码排版缩进

