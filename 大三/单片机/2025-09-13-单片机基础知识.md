# 第二周：51单片机

## 一、 51单片机硬件结构与核心组件

### 1.1 内部核心硬件结构

51系列单片机（以AT89S51为例）是在一个集成电路芯片上集成了微型计算机所需的核心功能部件 1。其主要硬件构成如下：

- **中央处理器 (CPU)**: 1个8位的微处理器，包含运算器和控制器。

- **程序存储器 (Program Memory)**: 4KB的Flash ROM，用于存放程序代码，断电后数据不丢失。

- **数据存储器 (Data Memory)**: 128B的RAM，用于程序运行时存放变量和临时数据，断电后数据丢失。

- **并行I/O端口**: 4个8位的可编程并行I/O口，分别为P0, P1, P2, P3。

- **串行通信口**: 1个全双工的异步串行口，可用于串行通信。

- **定时器/计数器**: 2个可编程的16位定时器/计数器。

- **中断系统**: 具有5个中断源和2级中断优先级。

- **看门狗定时器 (WDT)**: 1个看门狗定时器，用于在程序跑飞或陷入死循环时自动复位系统。

- **特殊功能寄存器 (SFR)**: 26个，用于对片内各功能部件进行管理、控制和监视。

### 1.2 存储器结构 (哈佛结构)

51单片机的一个显著特点是其存储器采**哈佛结构**，即将程序存储器和数据存储器在物理上分开，并使用不同的指令进行访。其存储空间可分为4类：

1. **程序存储器空间**: 用于存放程序和固定常数。片内有4KB Flash ROM，地址范围为0000H~0FFFH。片外可扩展至64KB。

2. **数据存储器空间**: 用于存放变量和数据。片内有128B RAM，地址范围为00H~7FH 15151515。片外可扩展至64KB RAM。

3. **特殊功能寄存器 (SFR) 空间**: 它们是各内部硬件的控制与状态寄存器，映射在片内RAM的高地址区80H~FFH内。

4. **位地址空间**: 51单片机支持位操作，其位地址空间由内部RAM的20H~2FH区域（128位）和部分可位寻址的SFR（83位）共同构成


### 1.3 I/O端口特性

- **P0口**: 双向8位I/O口，其结构为**漏极开路**，因此作为通用I/O口使用时**必须外接上拉电阻** 。在扩展外部存储器时，它还复用为地址/数据总线 。

- **P1, P2, P3口**: 这三个是准双向8位I/O口，**具有内部上拉电阻** 。

- **P2口**: P2口除了作为通用I/O口，在扩展外部存储器时还用作高8位地址总线 。

- **P3口**: P3口的每一个引脚都具有第二功能，如串行通信(RXD/TXD)、外部中断(INT0/INT1)、定时器计数(T0/T1)等 。

### 1.4 最小应用系统

单片机芯片要工作，必须具备一个最小应用系统，它由以下四部分构成 24：

1. **单片机芯片**: 核心控制器。

2. **电源电路**: 为芯片提供稳定的+5V工作电压。连接到VCC(40脚)和VSS/GND(20脚)。

3. **时钟电路**: 提供单片机工作的时钟信号，是所有指令执行的节拍基础。通常由一个石英晶体和两个微调电容构成，连接在XTAL1(19脚)和XTAL2(18脚) 。

4. **复位电路**: 确保单片机上电或在程序出错时能初始化到预设状态。通常连接到RST(9脚) 。

其简化电路图如下：

## 二、 C51编程入门与实践

### 2.1 开发流程概述

一个完整的单片机应用开发流程包括以下步骤：

1. **软件编程**: 使用Keil C51等集成开发环境编写C语言源程序 28。主要步骤包括新建工程、选择芯片型号、创建并添加`.c`文件、配置晶振频率和设置输出HEX文件。
2. **编译生成**: 将C语言代码编译、链接，最终生成单片机可识别的`.hex`可执行文件 。
3. **下载烧录**: 使用PZ-ISP等下载软件，通过串口将`.hex`文件下载到单片机芯片的程序存储器中 。
4. **硬件连接与运行**: 根据程序设计连接外部硬件（如LED），给系统上电，观察程序的运行结果并进行调试 。

### 2.2 C51核心编程概念

- **主函数与程序循环**: 单片机程序运行在没有操作系统的“裸机”环境，程序从`main`函数开始，且永不结束。因此，主函数通常声明为`void main()`，并且内部包含一个`while(1)`无限循环，以确保程序持续运行。

- **端口复位状态与初始化**: 根据课件，单片机在复位后，P0~P3四个I/O端口的初始状态值均为`FFH`，即所有引脚都为高电平。

  因此，在`main`函数开头，通常需要对用到的端口进行初始化（如`P2 = 0x00;`），以确保程序从一个已知的、确定的状态开始运行，避免出现上电后所有LED异常点亮等问题。

### 2.3 I/O端口的两种控制方法

| 特性         | 方法一：端口操作 (整体控制)                                  | 方法二：位操作 (精准控制)                                    |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **描述**     | 一次性对一个端口（8个引脚）整体赋值，同时改变8个引脚的状态。 | 使用`sbit`关键字给单个引脚定义别名，然后像操作变量一样单独控制它。 |
| **优点**     | 效率高，代码简洁，适合实现流水灯等多位联动的效果。           | 代码可读性强，意图明确，修改一个引脚不影响其他引脚。         |
| **缺点**     | 需进行进制换算，会覆盖整个端口原有状态。                     | 若要同时控制多个引脚，代码会比较冗长。                       |
| **语法示例** | `P0 = 0x55;` // P0口输出 01010101                            | `sbit D1 = P0^0; D1 = 1;`                                    |
| **课件应用** | 课堂应用案例3，直接定义P0口的值来点亮LED。                   | 课堂应用案例1，使用位定义语句点亮LED 。                      |

## 三、 关键概念辨析

### 3.1 C51 vs. 标准C语言

C51并非一门独立的语言，而是标准ANSI C语言的**扩展集**。它完全兼容标准C的语法，并在此基础上增加了`sbit`、`sfr`、`interrupt`等关键字以及`code`、`xdata`等内存类型，以支持51单片机特有的硬件功能（如I/O口位操作、中断系统、内存区域划分等）的直接访问。

### 3.2 位(Bit)、端口(Port)、引脚(Pin)的关系

- **引脚(Pin)**: 芯片上物理存在的金属引脚，是硬件世界最基本的输入/输出单元。
- **端口(Port)**: 软件层面的概念，是将8个物理引脚分组管理的一个集合。例如，P2端口包含了P2.0到P2.7这8个引脚 35。
- **位(Bit)**: 软件中的二进制值（0或1）。在单片机中，软件对端口寄存器中一个位的操作，会直接改变与之对应的物理引脚的电平状态（高电平或低电平）。

### 3.3 时钟与周期

- **时钟周期**: 单片机时序的最小单位，其值为晶振频率的倒数 36。例如，12MHz晶振的时钟周期为1/12μs。
- **机器周期**: CPU完成一个基本操作所需的时间，是单片机中衡量时间的基本单位。一个机器周期固定包含12个时钟周期 。
- **指令周期**: CPU执行一条完整指令所需的时间。根据指令的复杂程度，一条指令可能包含1个、2个或4个机器周期 38383838。
