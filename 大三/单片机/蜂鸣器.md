### 蜂鸣器笔记整理

**核心问题**：如何避免每次都重写 `delay()`延时函数？

**答案**：将 `delay`函数封装成一个公共模块，体现模块化的编程思想。

#### 一、创建延时函数模块

1. **创建公共资源文件夹**，包含两个文件： `delay.c` `delay.h`

2. **`delay.c`文件的标准写法**

   ```
   /*
    * 自定义双参数延时函数
    * 通过改变参数x和y的值来控制延时长度
    */
   void delay(unsigned int x, unsigned int y) 
   {
       unsigned int i, j;
       for (i = 0; i < x; i++)
       {
           for (j = 0; j < y; j++);
       }
   }
   ```

3. **`delay.h`头文件的标准写法**

   - 使用条件编译指令 `#ifndef...#define...#endif`来防止头文件被重复包含。

   ```
   #ifndef __delay_h__
   #define __delay_h__
   
   void delay (unsigned int z,unsigned int w)
   {
       unsigned int i,j;
       for(i=0;i<z;i++)
           for(j=0;j<w;j++);
   }
   
   #endif
   ```

#### 二、延时函数计时规则

以 **`delay(1000,40)`≈ 0.5秒**为基准来控制时间。

*注：有时也采用 `delay(1000,42)`≈ 0.5秒 为基准，因为42更方便作为除数。*

- `delay(1000, 40 * 2);`≈ 1 秒
- `delay(1000, 40);`≈ 0.5 秒
- `delay(1000, 40/2);`≈ 0.25 秒
- `delay(1000, 40/4);`≈ 0.125 秒

#### 三、蜂鸣器基础知识

- **分类**：有源 / **无源**（即 直流 / **交流**）
- **频率范围**：数字信号 340~3400Hz 作保留。用方波代表正弦波。
- **硬件连接**：接在 J8（读作“脚8”）上，上方波。
- **如何放大信号**：首先保证波形不变，然后放大电流（不选择放大电压）。

#### 四、操作蜂鸣器代码

- **采用位定义方法**：

  ```
  sbit fmq = P1^0;
  ```

- **基本操作代码**：

  ```c
  while(1)
  {
      fmq=0;
      delay(,); // 填入具体参数
      fmq=1;
      delay(,); // 填入具体参数
  }
  ```

#### 五、如何确定延时参数以控制音调

- 问题：`delay`具体填多少呢？
- 根据公式 `f = 1/T`。
- **结论**：**`delay(1000/x, 40/y)`对应的是 `x * y`Hz**。

#### 六、不同响声模式的编程模板

1. **发出连续声音的模板**：

   ```c
   while(1)
   {
       fmq=~fmq; // 不断翻转电平产生连续声音
       delay( , ); // 填入计算出的半周期延时参数
   }
   ```

2. **发出断续声音**（响一会停一会）：

   - **响**：对应周期电平，利用for循环实现。

   - **不响**：

     ```c
     fmq=0； // 将电平置零
     delay(,); // 静音延时
     ```

#### 七、课堂应用与示例代码

**应用要求**：**实现蜂鸣器发出500Hz、1000Hz、断续的声音。**

**示例代码**：

```c
#include <reg52.h>
#include "delay.h"
#define uint unsigned int

sbit fmq = P1^0;
uint i;

void main()
{
    while(1)
    {
        for(i=0; i<5400; i++)
        {
            fmq = ~fmq;
            delay(1000/1000, 42); // 产生1000Hz声音
        }
        fmq = 0; // 停止发声
        delay(1000 * 4, 42); // 静音一段时间
    }
}
```

